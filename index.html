<!doctype html>
<html>
<title>YouTube Video Timer</title>

<script>
  window.YTAPILoaded = new Promise(resolve => {
    window.onYouTubeIframeAPIReady = () => {
      resolve(window.YT);
    };
  });
</script>
<script src="https://www.youtube.com/iframe_api"></script>
<script>'use strict'; setTimeout(async () => {    
  const videoIdOrUrl = new URLSearchParams(location.search).get('videoId') || '';
  const videoId = videoIdOrUrl.replace(/^.*[\?\&]q=/, '').replace(/\?.*$/, '').replace(/^.*\//, '');

  if (!videoId) return;
    
  document.querySelector('[name=videoId]').value = videoId;
  
  const YT = await window.YTAPILoaded;
  const mainEl = document.querySelector('#main');

  mainEl.removeAttribute('disabled');
    
  const startTime = document.querySelector('#startTime');
  const endTime = document.querySelector('#endTime');
  const elapsedTime = document.querySelector('#elapsedTime');
  const startCap = document.querySelector('#startCap');
  const endCap = document.querySelector('#endCap');
      
  const updateElapsed = () => {
    elapsedTime.value = ((endTime.value) - Number(startTime.value)).toFixed(3);
  }
  
  startTime.onchange = endTime.onchange = updateElapsed;

  const placeholder = document.createElement('span');
  mainEl.appendChild(placeholder);
  const player = new YT.Player(placeholder, {
    videoId: videoId,
    playerVars: {
      rel: 0, // related videos overlay
      controls: 1,
      iv_load_policy: 3, // disabled annotations
      loop: 1,
      modestbranding: 1,
      autoplay: 1,
    },
    events: {
      onReady() {
        startTime.value = (0).toFixed(3);
        endTime.value = player.getDuration().toFixed(3);
        updateElapsed();
  
        startCap.onclick = () => {
          startTime.value = player.getCurrentTime().toFixed(3);
          updateElapsed();
        };
  
        endCap.onclick = () => {
          endTime.value = player.getCurrentTime().toFixed(3);
          updateElapsed();
        };
      
        mainEl.removeAttribute('disabled');
      }
    }
  });
});</script>

<h1>YouTube Video Timer</h1>

<form>
  <label>Video ID or URL: <input name="videoId" value="https://youtu.be/3gJHBA1go5I" /></label>
  <button type="submit">Load</button>
</form>

<main id="main" disabled>
  <p>
    You can use <kbd>,</kbd> and <kbd>.</kbd> to seek backwards
    and forwards by single frames in the YouTube player after
    clicking on it to pause the video.
  </p>

  <p>
    <label>Start Time: <input id="startTime" type="number" step="0.001" placeholder="1.000" /></label> <button id="startCap">Get Video Timestamp</button> <br />
    <label>End Time: <input id="endTime" type="number" step="0.001" placeholder="120.000" /></label> <button id="endCap">Get Video Timestamp</button> <br />
    <label>Elapsed Time: <input id="elapsedTime" type="number" step="0.001" placeholder="119.00" /></label>
  </p>
</main>

<style>
  html {
    font-family: Georgia, serif;
  }
  
  body {
    max-width: 800px;
  }
  
  kbd {
    border: 2px outset #CCC;
    padding: 0px 2px;
    background: #EEE
  }
  
  main[disabled] {
    pointer-events: none;
    opacity: 0.25;
    cursor: not-allowed;
    user-select: none;
  }
</style>
  